<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>AgroMatch - Dashboard Trabajador</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <link rel="stylesheet" href="../assent/css/index-trabajador.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <!-- Overlay para modales -->
    <div class="overlay" id="overlay"></div>
    
    <!-- Modal para confirmar postulación -->
    <div class="modal" id="applyJobModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Confirmar Postulación</h2>
                <button class="close-btn" onclick="closeApplyModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>¿Estás seguro de que quieres postularte a este trabajo?</p>
                <div id="jobDetailsForApplication"></div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeApplyModal()">
                    Cancelar
                </button>
                <button class="btn btn-primary" onclick="confirmApplication()" id="confirmApplyBtn">
                    <i class="fas fa-paper-plane"></i> Confirmar Postulación
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Búsqueda Avanzada -->
    <div class="modal" id="searchModal" style="display: none;">
        <div class="modal-content search-modal">
            <div class="modal-header">
                <h2><i class="fas fa-search"></i> Búsqueda Avanzada de Trabajos</h2>
                <button class="close-btn" onclick="closeSearchModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="search-form">
                    <div class="form-group">
                        <label><i class="fas fa-map-marker-alt"></i> Por Ubicación</label>
                        <input type="text" id="searchLocation" placeholder="Ej: Chinchiná, Caldas">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-seedling"></i> Por Tipo de Cultivo</label>
                        <select id="searchCropType">
                            <option value="">Todos los cultivos</option>
                            <option value="cafe">Café</option>
                            <option value="maiz">Maíz</option>
                            <option value="platano">Plátano</option>
                            <option value="yuca">Yuca</option>
                            <option value="cacao">Cacao</option>
                            <option value="frutas">Frutas</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-dollar-sign"></i> Por Rango de Pago (COP/día)</label>
                        <div class="range-inputs">
                            <input type="number" id="searchMinPay" placeholder="Mínimo" min="0" step="5000">
                            <span>-</span>
                            <input type="number" id="searchMaxPay" placeholder="Máximo" min="0" step="5000">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Por Disponibilidad</label>
                        <select id="searchAvailability">
                            <option value="">Cualquier fecha</option>
                            <option value="inmediato">Inmediato</option>
                            <option value="semana">Esta semana</option>
                            <option value="mes">Este mes</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="clearSearchFilters()">
                    <i class="fas fa-eraser"></i> Limpiar Filtros
                </button>
                <button class="btn btn-primary" onclick="applySearchFilters()">
                    <i class="fas fa-search"></i> Buscar Trabajos
                </button>
            </div>
        </div>
    </div>
    
    <!-- Dropdown dinámico del perfil -->
    <div id="dynamicProfileDropdown" style="
        position: fixed;
        top: 80px;
        right: 30px;
        z-index: 9999;
        min-width: 280px;
        display: none;
        opacity: 0;
        transform: translateY(-10px);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        pointer-events: none;
    ">
        <div class="dynamic-dropdown-content">
            <div class="dynamic-dropdown-header">
                <div class="dynamic-dropdown-avatar profile-photo" id="dropdownAvatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="dynamic-dropdown-name" id="dropdownName">Cargando...</div>
                <div class="dynamic-dropdown-role">
                    <i class="fas fa-seedling"></i>
                    <span>Trabajador Agrícola</span>
                </div>
            </div>
            <div class="dynamic-dropdown-menu">
                <div class="dynamic-dropdown-item" onclick="showProfile()">
                    <div class="icon"><i class="fas fa-user-circle"></i></div>
                    <span>Ver Perfil</span>
                </div>
                <div class="dynamic-dropdown-item" onclick="showStats()">
                    <div class="icon"><i class="fas fa-chart-bar"></i></div>
                    <span>Mis Estadísticas</span>
                </div>
                <div class="dynamic-dropdown-item" onclick="showHistorialEmpleos()">
                    <div class="icon"><i class="fas fa-history"></i></div>
                    <span>Historial de Empleos</span>
                </div>
                <div class="dynamic-dropdown-item" onclick="showPostulaciones()">
                    <div class="icon"><i class="fas fa-paper-plane"></i></div>
                    <span>Mis Postulaciones</span>
                </div>
                <!-- NUEVA OPCIÓN: Recomendaciones -->
                <div class="dynamic-dropdown-item" onclick="showRecomendaciones()">
                    <div class="icon"><i class="fas fa-lightbulb"></i></div>
                    <span>Recomendaciones para Ti</span>
                </div>
                <div class="dynamic-dropdown-item" onclick="showFavoritos()">
                    <div class="icon"><i class="fas fa-heart"></i></div>
                    <span>Mis Favoritos</span>
                </div>
                <div class="dynamic-dropdown-item" onclick="showSettings()">
                    <div class="icon"><i class="fas fa-cog"></i></div>
                    <span>Configuración</span>
                </div>
                <div class="dynamic-dropdown-item" onclick="showHelpSupport()">
                    <div class="icon"><i class="fas fa-question-circle"></i></div>
                    <span>Ayuda y Soporte</span>
                </div>
                <div class="dynamic-dropdown-item logout" onclick="logout()">
                    <div class="icon"><i class="fas fa-sign-out-alt"></i></div>
                    <span>Cerrar Sesión</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                 <img src="../assent/img/logo.jpg" alt="AgroMatch Logo" style="height:40px;">
            </div>
            <div class="header-actions">
                <!-- NUEVO: Botón de Recomendaciones en el Header -->
                <button class="btn btn-accent" onclick="showRecomendaciones()" title="Ver trabajos recomendados para ti">
                    <i class="fas fa-lightbulb"></i> Recomendaciones
                </button>
                <button class="btn btn-primary" onclick="searchJobs()">
                    <i class="fas fa-search"></i> Buscar Trabajos
                </button>
                <div class="notification-icon" onclick="showNotifications()">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">2</span>
                </div>
                <div class="profile-menu profile-photo" id="profileMenuBtn" onclick="toggleProfileMenu()">
                    <i class="fas fa-user"></i>
                </div>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="dashboard">
            <div class="main-panel">
                <!-- Search and Filters -->
                <div class="search-container">
                    <input type="text" class="search-bar" placeholder="Buscar trabajos por ubicación, tipo de cultivo, etc..." oninput="filterJobs(this.value)">
                    <i class="fas fa-search search-icon"></i>
                </div>

                <div class="filter-container">
                    <button class="filter-btn active" onclick="filterByType(this, 'todos')">Todos</button>
                    <button class="filter-btn" onclick="filterByType(this, 'cosecha')">Cosecha</button>
                    <button class="filter-btn" onclick="filterByType(this, 'siembra')">Siembra</button>
                    <button class="filter-btn" onclick="filterByType(this, 'mantenimiento')">Mantenimiento</button>
                    <button class="filter-btn" onclick="filterByType(this, 'recoleccion')">Recolección</button>
                </div>

                <!-- Quick Stats -->
                <div class="quick-stats">
                    <div class="quick-stat">
                        <div class="quick-stat-number" id="jobsNearCount">0</div>
                        <div class="quick-stat-label">Trabajos Cerca</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-number" id="applicationsCount">0</div>
                        <div class="quick-stat-label">Postulaciones</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-number" id="activeJobsCount">0</div>
                        <div class="quick-stat-label">En Progreso</div>
                    </div>
                </div>

                <div class="section-title">
                    <i class="fas fa-briefcase"></i>
                    Trabajos Disponibles
                </div>
                
                <!-- Contenedor de trabajos que se llenará dinámicamente -->
                <div class="job-list" id="jobsList">
                    <!-- Los trabajos se cargarán aquí dinámicamente -->
                </div>
                
                <!-- Mensaje cuando no hay trabajos -->
                <div class="no-jobs" id="noJobsMessage" style="display: none;">
                    <div class="no-jobs-content">
                        <i class="fas fa-briefcase"></i>
                        <h3>No hay trabajos disponibles</h3>
                        <p>No se encontraron ofertas de trabajo que coincidan con tus criterios.</p>
                    </div>
                </div>

                <!-- My Jobs Section -->
                <div class="my-jobs">
                    <div class="section-title">
                        <i class="fas fa-tasks"></i>
                        Mis Trabajos
                    </div>
                    
                    <!-- Contenedor de mis trabajos que se llenará dinámicamente -->
                    <div id="myJobsList">
                        <!-- Los trabajos aceptados se cargarán aquí -->
                    </div>
                    
                    <!-- Mensaje cuando no tengo trabajos -->
                    <div class="no-my-jobs" id="noMyJobsMessage" style="display: none;">
                        <div class="no-jobs-content">
                            <i class="fas fa-tasks"></i>
                            <h3>No tienes trabajos activos</h3>
                            <p>Postúlate a las ofertas disponibles para empezar a trabajar.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="side-panel">
                <!-- Profile Section -->
                <div class="profile-section">
                    <div class="profile-avatar profile-photo" id="profileAvatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="profile-name" id="profileName">Cargando...</div>
                    
                    <div class="rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <span class="rating-value">4.8</span>
                    </div>
                    
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <div class="stat-value" id="totalJobs">0</div>
                            <div class="stat-label">Trabajos</div>
                        </div>
                        <div class="profile-stat">
                            <div class="stat-value" id="totalHours">0h</div>
                            <div class="stat-label">Horas</div>
                        </div>
                    </div>
                </div>

                <!-- Map Section -->
                <div class="section-title">
                    <i class="fas fa-map"></i>
                    Trabajos Cercanos
                </div>
                <div id="map" style="height: 300px; border-radius: 15px; overflow: hidden; border: 2px solid #4a7c59;"></div>

                <!-- Notifications -->
                <div class="notifications">
                    <div class="section-title">
                        <i class="fas fa-bell"></i>
                        Notificaciones
                    </div>
                    
                    <div id="notificationsList">
                        <!-- Las notificaciones se cargarán aquí dinámicamente -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cargar el JavaScript al final -->
    <script src="../js/index-trabajador.js"></script>
    <script>
        // Función para mostrar recomendaciones
        function showRecomendaciones() {
            // Opción 1: Navegar a página de recomendaciones
            window.location.href = 'recomendaciones.html';
            
            // Opción 2: Si prefieres mantenerlo en la misma página con modal/vista
            // toggleProfileMenu(); // Cerrar el menú del perfil si está abierto
            // Aquí puedes agregar lógica para mostrar las recomendaciones
        }
    </script>
</body>
</html>